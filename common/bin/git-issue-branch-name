#!/usr/bin/env bash
set -e

if [[ -z "$1" ]]; then
  echo "Usage: $(basename "$0") <issue-number-or-url>"
  exit 1
fi

issue_number_or_url=$1
issue_number=$(echo $issue_number_or_url | sed -E 's#.*/([0-9]+)$#\1#')
issue_text=$(gh issue view $issue_number --json title --template '{{.title}}')
llm_prompt="Generate a concise, lowercase, hyphen-separated git branch name for the following GitHub issue. Start with 'issue-${issue_number}' followed by a short description of the issue. Only use letters, numbers, and hyphens. Do not include any other characters. Example: issue-${issue_number}-fix-the-thing\n\n$issue_text"
branch_name=$(echo "$llm_prompt" | llm)
echo "$branch_name"
