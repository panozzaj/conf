#!/bin/bash
# Git pre-commit hook to check all staged spec files for
# for save_and_open_page debugging scripts

FILES_PATTERN='_spec.rb$'
FORBIDDEN='save_and_open_page'

echo 'Checking for save_and_open_page calls in specs'

files=`git diff --cached --name-only | grep -E $FILES_PATTERN`

if [[ -z $files ]]; then
  echo 'No save_and_open_page calls.'
  exit 0
else
  GREP_COLOR='4;5;37;41' xargs grep --color --with-filename -n $FORBIDDEN $files && exit 1
fi

echo 'No save_and_open_page calls found in matching files.'
exit 0
